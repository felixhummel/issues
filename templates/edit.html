<!DOCTYPE html>
<html>
  <head>
    <title>Issues - Edit</title>
    <link rel="stylesheet" href="css/main.css" type="text/css">
  </head>
  <body>
    <p id="msg" style="float: right">Initial revision: {{rev}}</p>
    <p>{{created_at}}</p>
    <select id="status">
      {{#statuses}}
      <option>{{option}}</option>
      {{/statuses}}{{status}}
    </select>
    <p>{{text}}</p>
    <button id="remove">Remove</button>
  </body>
  {{>scripts}}
  <script type="text/javascript" charset="utf-8">
    $.couch.app(function(app) {
      var doc = {{{doc}}},  // parse doc from string
        sendMsg = function(msg) {
          $('#msg').hide().text(msg).fadeIn();
        },
        onError = function(status, error, reason) {
          if (error == 'conflict') {
            // get other doc, display
            $.log('onError called');
          } else {
            alert("Error " + reason)
          }
        }
      ; // END var
      delete doc._revisions;  // else: update conflict
      $("#remove").click(function() {
        $.log('remove clicked', doc);
      });
      $("#status")
        .val(doc.status)
        .change(function() {
          doc.status = $(this).val();
          app.db.saveDoc(doc, {
            success: function(resp) {
              sendMsg('Saved rev '+resp.rev);
            },
            error: onError
          });
        });
    });
  </script>

</html>
